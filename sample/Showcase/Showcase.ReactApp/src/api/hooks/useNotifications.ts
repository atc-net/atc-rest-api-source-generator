// <auto-generated />
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useApiService } from './useApiService';
import { ApiError } from '../errors/ApiError';
import type { CreateSubscriptionRequest, Subscription, Subscriptions } from '../models';
import type { NotificationType } from '../enums';

const notificationsKeys = {
  all: ['notifications'] as const,
  listSubscriptions: () => [...notificationsKeys.all, 'listSubscriptions'] as const,
  detail: (subscriptionId: string) => [...notificationsKeys.all, 'detail', subscriptionId] as const,
};

export { notificationsKeys };

export function useListSubscriptions() {
  const api = useApiService();
  return useQuery({
    queryKey: notificationsKeys.listSubscriptions(),
    queryFn: async () => {
      const result = await api.notifications.listSubscriptions();
      if (result.status === 'ok' || result.status === 'created') {
        return result.data;
      }
      throw new ApiError(
        result.response.status,
        result.response.statusText,
        'error' in result ? result.error.message : 'Request failed',
        result.response,
      );
    },
  });
}

export function useCreateSubscription() {
  const api = useApiService();
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async (body: CreateSubscriptionRequest) => {
      const result = await api.notifications.createSubscription(body);
      if (result.status === 'ok' || result.status === 'created') {
        return result.data;
      }
      throw new ApiError(
        result.response.status,
        result.response.statusText,
        'error' in result ? result.error.message : 'Request failed',
        result.response,
      );
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: notificationsKeys.all });
    },
  });
}

export function useGetSubscriptionById(subscriptionId: string) {
  const api = useApiService();
  return useQuery({
    queryKey: notificationsKeys.detail(subscriptionId),
    queryFn: async () => {
      const result = await api.notifications.getSubscriptionById(subscriptionId);
      if (result.status === 'ok' || result.status === 'created') {
        return result.data;
      }
      throw new ApiError(
        result.response.status,
        result.response.statusText,
        'error' in result ? result.error.message : 'Request failed',
        result.response,
      );
    },
    enabled: !!subscriptionId,
  });
}

export function useDeleteSubscription() {
  const api = useApiService();
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async (subscriptionId: string) => {
      const result = await api.notifications.deleteSubscription(subscriptionId);
      if (result.status === 'noContent' || result.status === 'ok') {
        return;
      }
      throw new ApiError(
        result.response.status,
        result.response.statusText,
        'error' in result ? result.error.message : 'Request failed',
        result.response,
      );
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: notificationsKeys.all });
    },
  });
}

// Streaming operation listNotifications is skipped.